<ion-header [translucent]="false">
  <ion-toolbar class="custom-toolbar">
    <div class="header-container">
      <!-- Logo -->
      <div class="logo-section">
        <img src="assets/images/logo.png" alt="Card Hunters" class="logo">
        <div class="logo-text">
          <span class="logo-title">CARD</span>
          <span class="logo-subtitle">HUNTERS</span>
        </div>
      </div>

      <!-- Barra de búsqueda -->
      <div class="search-section">
        <div class="search-container">
          <ion-icon name="search-outline" class="search-icon"></ion-icon>
          <input type="text" placeholder="Búsqueda" class="search-input">
        </div>
      </div>

      <!-- Carrito e icono de usuario -->
      <div class="actions-section">
        <ion-button fill="clear" class="cart-btn" routerLink="/tabs/carrito">
          <ion-icon name="bag-outline" class="cart-icon"></ion-icon>
        </ion-button>

        <div class="user-profile">
          <ion-button fill="clear" class="profile-btn">
            <ion-icon name="person-outline" class="profile-icon"></ion-icon>
          </ion-button>
        </div>
      </div>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="historial-content">
  <div class="content-wrapper">

    <!-- Título de la sección -->
    <div class="section-header">
      <ion-icon name="receipt" class="section-icon"></ion-icon>
      <h2 class="section-title">Historial de Compras:</h2>
    </div>

    <!-- Lista de pedidos -->
    <div class="pedidos-lista" *ngIf="!cargando">
      <div
        *ngFor="let pedido of pedidosFiltrados; trackBy: trackByPedido"
        class="pedido-card">

        <!-- Imagen del producto principal -->
        <div class="product-image-container">
          <img
            [src]="pedido.items[0].carta.imagen"
            [alt]="pedido.items[0].carta.nombre"
            class="product-image">

          <!-- Badge de rareza -->
          <div class="rareza-badge" [attr.data-rareza]="pedido.items[0].carta.rareza.toLowerCase()">
            {{ pedido.items[0].carta.rareza }}
          </div>
        </div>

        <!-- Información del pedido -->
        <div class="pedido-info">
          <h3 class="product-name">{{ pedido.items[0].carta.nombre }}</h3>

          <div class="pedido-details">
            <p class="detail-row">
              <strong>Fecha de Compra:</strong> {{ formatearFecha(pedido.fecha) }}
            </p>

            <p class="detail-row">
              <strong>Comprado en Región:</strong> {{ pedido.direccionEnvio.ciudad }}
            </p>

            <p class="detail-row">
              <strong>Comuna:</strong> {{ getComuna(pedido) }}
            </p>
          </div>
        </div>

        <!-- Precio -->
        <div class="precio-container">
          <span class="precio-label">Precio:</span>
          <span class="precio-value">{{ formatearPrecio(pedido.total) }}</span>
        </div>
      </div>
    </div>

    <!-- Estado de carga -->
    <div *ngIf="cargando" class="loading-state">
      <p>Cargando historial...</p>
    </div>

    <!-- Sin pedidos -->
    <div *ngIf="!cargando && pedidosFiltrados.length === 0" class="empty-state">
      <p>No hay pedidos en tu historial</p>
      <ion-button routerLink="/tabs/catalogo" fill="outline">
        Explorar Catálogo
      </ion-button>
    </div>
  </div>
</ion-content>
